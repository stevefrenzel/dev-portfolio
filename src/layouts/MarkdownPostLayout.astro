---
import type { FrontmatterProps } from "../types/FrontmatterProps";
import Layout from "@layouts/Layout.astro";
import SkipLink from "@utils/SkipLink.astro";
import { Image } from "astro:assets";

interface Props {
  frontmatter: FrontmatterProps;
  readingTime: number | undefined;
}

const { frontmatter, readingTime } = Astro.props;

const dateFormatted = new Date(frontmatter.pubDate).toLocaleDateString(
  undefined,
  { year: "numeric", month: "long", day: "numeric" },
);

const socialImageUrl = `${Astro.site}thumbnails/${frontmatter.thumbnail}`;
---

<Layout
  description={frontmatter.description}
  thumbnail={socialImageUrl}
  title={frontmatter.title}
>
  <div id="markdown-wrapper">
    <header>
      <SkipLink />
      <h1>{frontmatter.title}</h1>
      <div class="header-info">
        <div>
          <p class="author-and-date">
            {frontmatter.author} - {dateFormatted}
          </p>
          <time datetime="">{readingTime} minutes read</time>
        </div>
        <a href="/blog">Back to blog</a>
      </div>
      <!-- TODO Change URL back to frontmatter.image.url.src -->
      <Image
        alt={frontmatter.image.alt}
        height={410}
        loading="eager"
        src={socialImageUrl}
        width={728}
      />
    </header>
    <main id="main">
      <div class="markdown-content">
        <slot />
      </div>
      <footer id="related-tags">
        <h2>Related tags</h2>
        <ul class="tags">
          {
            frontmatter.tags.map((tag) => (
              <li class="tag">
                <a href={`/tags/${tag}`}>{tag}</a>
              </li>
            ))
          }
        </ul>
      </footer>
    </main>
  </div>
</Layout>

<style is:global lang="scss">
  #markdown-wrapper {
    margin: 0 auto;
    max-width: 768px;
    padding: 0 var(--space-s);

    header a:not(#skip-link) {
      font-size: var(--step-0);
    }

    .header-info {
      align-items: baseline;
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-2xs);
      justify-content: space-between;
    }

    header img {
      margin-top: var(--space-m);
    }

    .author-and-date,
    time {
      font-size: var(--step-0);
    }

    ul:not(.tags) {
      list-style-type: initial;
    }

    img:not(.arrow-down) {
      height: auto;
      width: 100%;
    }

    main pre {
      font-size: var(--step-0);
      padding: var(--space-xs);
    }

    code {
      font-size: var(--step-0);
      padding: 1%;
    }
  }

  .markdown-content {
    blockquote {
      margin: var(--space-m) var(--space-s) 0 var(--space-s);
      padding-left: var(--space-xs);

      p {
        font-style: italic;
        margin-top: 0;
      }
    }

    img {
      margin-top: var(--space-m);
    }

    ol {
      list-style-type: decimal;
    }
  }

  #related-tags {
    margin-top: var(--space-l);
    padding: var(--space-m) 0;

    h2 {
      font-size: var(--step-2);
      margin: 0;
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-s);
      padding: 0;
    }

    a {
      border-radius: 5px;
      font-size: var(--step-0);
      padding: var(--space-2xs);
    }
  }
</style>
